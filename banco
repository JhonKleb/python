DROP TABLE IF EXISTS denuncia CASCADE;
DROP TABLE IF EXISTS patrimonio CASCADE;
DROP TABLE IF EXISTS login CASCADE;
DROP TABLE IF EXISTS aluno CASCADE;
DROP TABLE IF EXISTS servidor CASCADE;

CREATE TABLE aluno (
    matricula_al BIGINT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE,
    turma VARCHAR(50)
);

CREATE TABLE servidor (
    matricula_serv BIGINT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE
);

CREATE TABLE login (
    id_login SERIAL PRIMARY KEY,
    matricula_al BIGINT NULL,
    matricula_serv BIGINT NULL,
    senha VARCHAR(255) NOT NULL,
    CONSTRAINT fk_login_al FOREIGN KEY (matricula_al) REFERENCES aluno(matricula_al) ON DELETE CASCADE,
    CONSTRAINT fk_login_serv FOREIGN KEY (matricula_serv) REFERENCES servidor(matricula_serv) ON DELETE CASCADE
);

CREATE TABLE patrimonio (
    tombo BIGINT PRIMARY KEY,
    descricao VARCHAR(255) NOT NULL,
    situacao VARCHAR(50) DEFAULT 'Em funcionamento',
    data_registro DATE DEFAULT CURRENT_DATE,
    local VARCHAR(100) NOT NULL
);

CREATE TABLE denuncia (
    id_denuncia SERIAL PRIMARY KEY,
    tombo BIGINT NOT NULL,
    matricula_al BIGINT NOT NULL,
    descricao TEXT NOT NULL,
    status VARCHAR(50) DEFAULT 'Aberta',
    data_denuncia TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    localizacao VARCHAR(100),
    CONSTRAINT fk_denuncia_patr FOREIGN KEY (tombo) REFERENCES patrimonio(tombo) ON DELETE CASCADE,
    CONSTRAINT fk_denuncia_al FOREIGN KEY (matricula_al) REFERENCES aluno(matricula_al) ON DELETE CASCADE
);

INSERT INTO servidor (matricula_serv, nome, email)
VALUES (242543, 'ServidorEx', 'servex@gmail.com');

INSERT INTO patrimonio (tombo, descricao, situacao, local) 
VALUES (4569, 'Projetor Epson', 'Em funcionamento', 'Laboratório 01');

INSERT INTO aluno (matricula_al, nome, email, turma) 
VALUES (2023120230020, 'Jhon Kleber Silva Costa', 'jhonklebersilvacosta0@gmail.com', 'INFO3A');

INSERT INTO denuncia (tombo, matricula_al, descricao, localizacao) 
VALUES (4569, 2023120230020, 'Projetor não está ligando', 'Laboratório 01');
